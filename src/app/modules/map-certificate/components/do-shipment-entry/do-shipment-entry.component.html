<div class="container-fluid">
    <div class="row">
        <div class="col-xl-12">
            <div class="card shadow-sm p-2 mb-2 bg-white rounded">
                <div class="card-header">
                    <h6>Shipment : {{ shipmentNo }}</h6>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col">
                            <h6>Shipment Info</h6>
                        </div>
                    </div>
                    <div class="row mt-2">
                        <div class="col-2 text-end">
                            <label>Customer : </label>
                        </div>
                        <div class="col text-start">
                            {{ shipmentInfo.customerCode }} : {{ shipmentInfo.customerName }}
                        </div>
                    </div>
                    <div class="row mt-2">
                        <div class="col-2 text-end">
                            <label>Ship to :</label>
                        </div>
                        <div class="col-4">
                            {{ shipmentInfo.shiptoCode }} : {{ shipmentInfo.shiptoName }}
                        </div>
                        <div class="col-2 text-end">
                            <label>สถานที่จัดส่ง :</label>
                        </div>
                        <div class="col-4">
                            {{ shipmentInfo.district }} , {{ shipmentInfo.province }}
                        </div>
                    </div>
                    <div class="row mt-2">
                        <div class="col-2 text-end">
                            <label>ทะเบียนรถ :</label>
                        </div>
                        <div class="col-4">
                            {{ shipmentInfo.carRegistration }}
                        </div>
                        <div class="col-2 text-end">
                            <label>เวลารถออก :</label>
                        </div>
                        <div class="col-4">
                            {{ shipmentInfo.outTime | date: 'dd-MMM-yyyy HH:mm'}}
                        </div>
                    </div>
                    <div class="row mt-2">
                        <div class="col-2 text-end pt-1">
                            <label for="">Customer Contact :</label>
                        </div>
                        <div class="col-2">
                            <input appRequiredInput id="customerContact" type="text" class="form-control"
                                [(ngModel)]="shipmentInfo.customerContact">
                        </div>
                        <div class="col-2 offset-2 text-end pt-1">
                            <label>Line :</label>
                        </div>
                        <div class="col-2">
                            <input appRequiredInput id="line" type="text" class="form-control"
                                [(ngModel)]="shipmentInfo.line">
                        </div>
                    </div>
                    <div class="row mt-2 mb-4">
                        <div class="col-2 text-end pt-1">
                            <label for="">Telephone :</label>
                        </div>
                        <div class="col-2">
                            <input appRequiredInput id="customerContact" type="text" class="form-control"
                                [(ngModel)]="shipmentInfo.contactTel">
                        </div>
                    </div>
                    <hr>
                    <div class="row" *ngFor="let item of list">
                        <div class="col-12">
                            <div class="row mt-4">
                                <div class="col-12">
                                    <h6>DO {{item.doNo}}</h6>
                                </div>
                            </div>

                            <div class="row mt-2">
                                <div class="col-12">
                                    <dx-data-grid id="gridContainer" [dataSource]="item.dataSource"
                                        [remoteOperations]="false" [allowColumnReordering]="true"
                                        [rowAlternationEnabled]="false" [showBorders]="true" [width]="'100%'"
                                        [showColumnLines]="true" [showRowLines]="true">
                                        <dxi-column dataField="itemIndex" caption="No." [width]="40" alignment="center"
                                            cellTemplate="indexTemplate">
                                            <div *dxTemplate="let cell of 'indexTemplate'">
                                                {{cell.value}}.
                                            </div>
                                        </dxi-column>
                                        <dxi-column dataField="materialCode" caption="Material" width="150"
                                            alignment="left"></dxi-column>
                                        <dxi-column dataField="materialDesc" caption="Material Description"
                                            minWidth="250" alignment="left"></dxi-column>
                                        <dxi-column dataField="sprayType" caption="รูปแบบการพ่น" [width]="120"
                                            alignment="left"></dxi-column>
                                        <dxi-column dataField="heatNo" caption="Heat No." [width]="80"
                                            alignment="center"></dxi-column>
                                        <dxi-column dataField="grade" caption="Grade" [width]="80"
                                            alignment="center"></dxi-column>
                                        <dxi-column dataField="quantity" caption="Quantity" [width]="80"
                                            alignment="right"></dxi-column>
                                        <dxi-column dataField="weight" caption="Weight" [width]="80"
                                            cellTemplate="numberTemplate" alignment="right"></dxi-column>
                                        <dxi-column dataField="unit" caption="Unit" [width]="60"
                                            alignment="center"></dxi-column>
                                        <dxi-column dataField="pkStatus" caption="Picking Status" dataType="string"
                                            [width]="100" alignment="center"
                                            cellTemplate="pkStatusTemplate"></dxi-column>
                                        <dxi-column [width]="120" alignment="center" cellTemplate="selectTemplate">
                                            <div *dxTemplate="let cell of 'selectTemplate'">
                                                <button style="width: 90px;" *ngIf="cell.data.status == 'Select'"
                                                    class="btn btn-sm btn-outline-success"
                                                    (click)="onClickSelect(cell.data)"><i class="fa-solid fa-check"></i>
                                                    Select</button>
                                                <button style="width: 90px;" *ngIf="cell.data.status != 'Select'"
                                                    class="btn btn-sm btn-outline-warning"
                                                    (click)="onClickEdit(cell.data)"><i
                                                        class="fa-solid fa-pen-to-square"></i> Edit</button>
                                            </div>
                                        </dxi-column>
                                        <dxi-column [width]="120" alignment="center" cellTemplate="addDetailTemplate">
                                            <div *dxTemplate="let cell of 'addDetailTemplate'">
                                                <button class="btn btn-sm btn-outline-secondary"
                                                    (click)="onClickAddDetail(cell.data)"><i
                                                        class="fa-solid fa-pen-to-square"></i> Add
                                                    Detail</button>
                                            </div>
                                        </dxi-column>

                                        <div *dxTemplate="let cell of 'pkStatusTemplate'">
                                            <label
                                                [ngClass]="{'complete-picking' : cell.data.pkStatus == 'Complete','wait-picking' : cell.data.pkStatus == 'Wait' }">
                                                {{ cell.data.pkStatus }}
                                            </label>
                                        </div>

                                        <div *dxTemplate="let cell of 'numberTemplate'">
                                            {{cell.value | number: '.2'}}
                                        </div>
                                    </dx-data-grid>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- <div class="row mt-4">
                        <div class="col">
                            <div class="row">
                                <input #fileInput class="form-control rounded-pill" type="file" id="fileInput"
                                    (change)="handleFileInput($event)" style="display: none;">
                                <div class="col-1 text-center">
                                    <label for="fileInput">
                                        <i class="fa-regular fa-square-plus click"
                                            style="color: green; font-size: xx-large;"></i>
                                    </label>

                                </div>
                                <ng-container *ngFor="let item of fileToUploads">
                                    <div class="col-1 text-center">
                                        <i class="fa-solid fa-file-lines file-icon" (click)="Test(item)"></i><br>
                                        <span>{{item.name}}</span>
                                    </div>
                                </ng-container>
                            </div>
                        </div>
                    </div> -->
                    <hr class="mt-4">
                    <div class="row mt-4">
                        <div class="col">
                            <h6>Attachment File</h6>
                        </div>
                    </div>
                    <div class="row mt-2">
                        <div class="col">
                            <input type="checkbox" id="standard" class="form-check-input me-2">
                            <label for="standard" class="click">ใบรับรองการสั่งซื้อสินค้า</label>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col text-end">
                            <input #fileInput class="form-control rounded-pill" type="file" id="fileInput"
                                (change)="handleFileInput($event)" style="display: none;">
                            <label>
                                <button class="btn btn-sm btn-success" (click)="upload(fileInput)">
                                    <i class="fa-solid fa-plus"></i>
                                    Attach
                                </button>
                            </label>
                        </div>
                    </div>
                    <div class="row mt-2">
                        <div class="col">
                            <dx-data-grid id="gridContainer" [dataSource]="fileToUploads" [remoteOperations]="false"
                                [allowColumnReordering]="true" [rowAlternationEnabled]="false" [showBorders]="true"
                                [width]="'100%'" [showColumnLines]="true" [showRowLines]="true">

                                <dxi-column caption="No." width="60" alignment="center" cellTemplate="noTemplate">
                                    <div *dxTemplate="let cell of 'noTemplate'">
                                        {{ cell.rowIndex + 1 }}
                                    </div>
                                </dxi-column>
                                <dxi-column dataField="file" caption="Description" minWidth="150"
                                    alignment="left"></dxi-column>
                                <dxi-column dataField="uploadTime" caption="Upload Time" width="150" alignment="center"
                                    cellTemplate="dateTimeTemplate"></dxi-column>
                                <div *dxTemplate="let cell of 'dateTimeTemplate'">
                                    {{ cell.value | date: 'dd-MMM-yyyy HH:mm' }}
                                </div>
                            </dx-data-grid>
                        </div>
                    </div>

                    <div class="row mt-4">
                        <div class="col">

                        </div>
                    </div>
                    <div class="row">
                        <div class="col-12 text-center mt-4">
                            <button class="btn btn-sm btn-primary"
                                [disabled]="!canSent || !shipmentInfo.customerContact || !shipmentInfo.contactTel || !shipmentInfo.line"
                                (click)="onClickSentLink()"><i class="fa-regular fa-paper-plane"></i> Sent
                                Link</button>
                            <button class="btn btn-sm btn-success ms-2 me-2" (click)="onClickSave()"><i
                                    class="fa-regular fa-floppy-disk"></i> Save</button>
                            <button class="btn btn-sm btn-secondary" (click)="onClickExit()"><i
                                    class="fa-solid fa-xmark"></i>
                                Exit</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


<ng-template #selectTMTTemplate>
    <div class="modal-header">
        <h5 class="modal-title">Select Quantity</h5>
    </div>

    <div class="modal-body">
        <div class="row mt-4">
            <div class="col-2 text-end">
                Material :
            </div>
            <div class="col-4">
                {{selected.materialCode}} : {{selected.materialDesc}}
            </div>

            <div class="col-2 text-end">
                Heat No. :
            </div>
            <div class="col-4">
                {{selected.heatNo}}
            </div>
        </div>

        <div class="row mt-2">
            <div class="col-2 text-end">
                รูปแบบการพ่น :
            </div>
            <div class="col-4">
                {{selected.sprayType}}
            </div>

            <div class="col-2 text-end">
                Grade :
            </div>
            <div class="col-4">
                {{selected.grade}}
            </div>
        </div>

        <div class="row mt-2">
            <div class="col-2 text-end">
                ความหนา :
            </div>
            <div class="col-4" *ngIf="!!selectDataSource[0]">
                {{selectDataSource[0].thickness | number: '.2'}}
            </div>

            <div class="col-2 text-end">
                หน้ากว้าง :
            </div>
            <div class="col-4" *ngIf="!!selectDataSource[0]">
                {{selectDataSource[0].width | number: '.2'}}
            </div>
        </div>

        <div class="row mt-2">
            <div class="col-2 text-end">
                Quantity :
            </div>
            <div class="col-4">
                {{selected.quantity | number: '.2'}} PC.
            </div>
            <div class="col-2 text-end">
                Selected Quantity :
            </div>
            <div class="col-4">
                {{totalSelectTMT() | number: '.2'}} PC.
            </div>
        </div>

        <div class="row mt-2">
            <div class="col-2 text-end">
                Certificate No. :
            </div>
            <div class="col-3">
                <input class="form-control">
            </div>
            <div class="col-1">

            </div>
            <div class="col-2 text-end">
                Mill :
            </div>
            <div class="col-3">
                <input class="form-control">
            </div>
            
        </div>

        <div class="row mt-2">
            <div class="col-2 text-end">
                Heat No. :
            </div>
            <div class="col-3">
                <input class="form-control">
            </div>
            <div class="col-1">

            </div>
            <div class="col-2 text-end">
                Grade :
            </div>
            <div class="col-3">
                <input class="form-control">
            </div>
            
            
        </div>

        <div class="row mt-2">
            <div class="col-2 text-end">
                ความหนา :
            </div>
            <div class="col-3">
                <input class="form-control">
            </div>
            <div class="col-1">

            </div>
            <div class="col-2 text-end">
                หน้ากว้าง :
            </div>
            <div class="col-3">
                <input class="form-control">
            </div>
            

        </div>

        <div class="row mt-2">
            <div class="col offset-2 ">
                <button class="btn btn-sm btn-success ">
                    <i class="fa-solid fa-magnifying-glass"></i>
                    Search
                </button>
                <button class="btn btn-sm btn-secondary ms-2">
                    <i class=" fa-solid fa-broom"></i>
                    Clear
                </button>
            </div>
        </div>

        <div class="row mt-4">
            <div class="col-12">.
                <dx-data-grid id="gridContainer" [dataSource]="selectTMTDataSource" [remoteOperations]="false"
                    [allowColumnReordering]="true" [rowAlternationEnabled]="true" [showBorders]="true" [width]="'100%'"
                    [showColumnLines]="true" [showRowLines]="true" [showBorders]="true" [rowAlternationEnabled]="true">
                    <dxi-column dataField="isSelected" caption="" [width]="40" alignment="right"
                        cellTemplate="checkBoxTemplate">
                        <div *dxTemplate="let cell of 'checkBoxTemplate'">
                            <div class="text-center">
                                <input [disabled]="!canSelectTMT() && !cell.value" class="form-check-input"
                                    type="checkbox" [(ngModel)]="cell.value"
                                    (change)="onCheckBoxChange($event,cell.data)">
                            </div>
                        </div>
                    </dxi-column>
                    <dxi-column dataField="certNo" caption="Certificate No." [width]="100"
                        alignment="center"></dxi-column>
                    <dxi-column dataField="itemIndex" caption="No." [width]="40" alignment="center"
                        cellTemplate="indexTemplate">
                        <div *dxTemplate="let cell of 'indexTemplate'">
                            {{cell.value}}.
                        </div>
                    </dxi-column>
                    <dxi-column dataField="material" caption="Material" [width]="150" alignment="left"></dxi-column>
                    <dxi-column dataField="materialDesc" caption="Material Description" minWidth="300"
                        alignment="left"></dxi-column>

                    <dxi-column dataField="heatNo" caption="Heat No." [width]="120" alignment="center"></dxi-column>
                    <dxi-column dataField="grade" caption="Grade" [width]="100" alignment="center"></dxi-column>
                    <dxi-column dataField="thickness" caption="ความหนา" [width]="80" alignment="right"
                        cellTemplate="numberTemplate"></dxi-column>
                    <dxi-column dataField="width" caption="หน้ากว้าง" [width]="80" alignment="right"
                        cellTemplate="numberTemplate"></dxi-column>
                    <dxi-column dataField="yield" caption="Yield" [width]="80" alignment="right"
                        cellTemplate="numberTemplate"></dxi-column>
                    <dxi-column dataField="tensile" caption="Tensile" [width]="80" alignment="right"
                        cellTemplate="numberTemplate"></dxi-column>

                    <dxi-column dataField="mill" caption="Mill" [width]="80" alignment="center"></dxi-column>
                    <dxi-column dataField="quantity" caption="Quantity" [width]="120" alignment="right"></dxi-column>
                    <dxi-column dataField="unit" caption="Unit" [width]="60" alignment="center">
                    </dxi-column>
                    <dxi-column dataField="weight" caption="Weight" [width]="80" cellTemplate="numberTemplate"
                        alignment="right"></dxi-column>
                    <div *dxTemplate="let cell of 'numberTemplate'">
                        {{cell.value | number: '.2'}}
                    </div>
                </dx-data-grid>
            </div>
        </div>
        <div class="row mt-4">
            <div class="col-12 text-center">
                <button [disabled]="totalSelectTMT() > 0 && selected.quantity > totalSelectTMT()"
                    class="btn btn-sm btn-success" (click)="onClickConfirmSelect(true)"><i
                        class="fa-regular fa-circle-check"></i> Confirm</button>
                <button class="btn btn-sm btn-secondary ms-2" (click)="modalRef.hide()"><i class="fa-solid fa-ban"></i>
                    Cancel</button>
            </div>
        </div>
    </div>
</ng-template>

<ng-template #selectTemplate>
    <div class="modal-header">
        <h5 class="modal-title">Select Quantity</h5>
    </div>

    <div class="modal-body">
        <div class="row mt-4">
            <div class="col-2 text-end">
                Material :
            </div>
            <div class="col-4">
                {{selected.materialCode}} : {{selected.materialDesc}}
            </div>

            <div class="col-2 text-end">
                Heat No. :
            </div>
            <div class="col-4">
                {{selected.heatNo}}
            </div>
        </div>

        <div class="row mt-2">
            <div class="col-2 text-end">
                รูปแบบการพ่น :
            </div>
            <div class="col-4">
                {{selected.sprayType}}
            </div>

            <div class="col-2 text-end">
                Grade :
            </div>
            <div class="col-4">
                {{selected.grade}}
            </div>
        </div>

        <div class="row mt-2">
            <div class="col-2 text-end">
                Quantity :
            </div>
            <div class="col-4">
                {{selected.quantity | number: '.2'}} PC.
            </div>
            <div class="col-2 text-end">
                Selected Quantity :
            </div>
            <div class="col-4">
                {{totalSelect() | number: '.2'}} PC.
            </div>
        </div>
        <div class="row mt-4">
            <div class="col-12 overflow-auto">
                <dx-data-grid id="gridContainer" [dataSource]="selectDataSource" [remoteOperations]="false"
                    [allowColumnReordering]="true" [rowAlternationEnabled]="true" [showBorders]="true" [width]="'100%'"
                    [showColumnLines]="true" [showRowLines]="true" [showBorders]="true" [rowAlternationEnabled]="true">
                    <dxi-column dataField="isSelected" caption="" [width]="40" alignment="right"
                        cellTemplate="checkBoxTemplate">
                        <div *dxTemplate="let cell of 'checkBoxTemplate'">
                            <div class="text-center">
                                <input [disabled]="!canSelect() && !cell.value" class="form-check-input" type="checkbox"
                                    [(ngModel)]="cell.value" (change)="onCheckBoxChange($event,cell.data)">
                            </div>
                        </div>
                    </dxi-column>
                    <dxi-column dataField="certNo" caption="Certificate No." [width]="100"
                        alignment="center"></dxi-column>
                    <dxi-column dataField="itemIndex" caption="No." [width]="40" alignment="center"
                        cellTemplate="indexTemplate">
                        <div *dxTemplate="let cell of 'indexTemplate'">
                            {{cell.value}}.
                        </div>
                    </dxi-column>
                    <dxi-column dataField="material" caption="Material" [width]="150" alignment="left"></dxi-column>
                    <dxi-column dataField="materialDesc" caption="Material Description" minWidth="300"
                        alignment="left"></dxi-column>

                    <dxi-column dataField="heatNo" caption="Heat No." [width]="120" alignment="center"></dxi-column>
                    <dxi-column dataField="grade" caption="Grade" [width]="100" alignment="center"></dxi-column>
                    <dxi-column dataField="yield" caption="Yield" [width]="80" alignment="right"
                        cellTemplate="numberTemplate"></dxi-column>
                    <dxi-column dataField="tensile" caption="Tensile" [width]="80" alignment="right"
                        cellTemplate="numberTemplate"></dxi-column>

                    <dxi-column dataField="mill" caption="Mill" [width]="80" alignment="center"></dxi-column>
                    <dxi-column dataField="quantity" caption="Quantity" [width]="120" alignment="right"
                        cellTemplate="numberTemplate"></dxi-column>
                    <dxi-column dataField="unit" caption="Unit" [width]="60" alignment="center"></dxi-column>
                    <dxi-column dataField="weight" caption="Weight" [width]="80" cellTemplate="numberTemplate"
                        alignment="right"></dxi-column>
                    <div *dxTemplate="let cell of 'numberTemplate'">
                        {{cell.value | number: '.2'}}
                    </div>
                </dx-data-grid>
            </div>
        </div>

        <div class="row mt-4">
            <div class="col-12 text-center">
                <button [disabled]="totalSelect() > 0 && selected.quantity > totalSelect()"
                    class="btn btn-sm btn-success" (click)="onClickConfirmSelect(false)"><i
                        class="fa-regular fa-circle-check"></i> Confirm</button>
                <button class="btn btn-sm btn-secondary ms-2" (click)="modalRef.hide()"><i class="fa-solid fa-ban"></i>
                    Cancel</button>
            </div>
        </div>
    </div>
</ng-template>

<ng-template #addDetailTemplate>
    <div class="modal-header">
        <h5 class="modal-title">Add Detail</h5>
    </div>

    <div class="modal-body">
        <div class="row mt-4" *ngIf="isType3">
            <div class="col-2 text-end">
                <label for="productionNo">เลขที่ใบสั่งผลิต</label>
            </div>
            <div class="col-3">
                <input type="text" id="detail" class="form-control">
            </div>
            <div class="col-2 offset-1 text-end">
                <label for="certificateDate" class="pt-1">วันที่ออกใบรับรอง</label>
            </div>
            <div class="col-3">
                <input type="text" id="certificateDate" class="form-control">
            </div>
        </div>
        <div class="row mt-4">
            <div class="col-2 text-end">
                <label for="detail" class="pt-1">Detail</label>
            </div>
            <div class="col-9">
                <textarea type="text" id="detail" class="form-control" rows="4"></textarea>
            </div>
        </div>
        <div class="row mt-2">
            <div class="col-2 pt-1 text-end">
                <label for="isStamp">Stamp</label>
            </div>
            <div class="col-1 pt-1">
                <input name="isStamp" class="form-check-input" type="checkbox" [(ngModel)]="selectStemp"
                    value="isStamp">
            </div>

        </div>
        <div class="col-12 text-center mt-4">
            <button class="btn btn-sm btn-success" (click)="onClickConfirmAddDetail()"><i
                    class="fa-regular fa-circle-check"></i>
                Confirm</button>
            <button class="btn btn-sm btn-secondary ms-2" (click)="modalRef.hide()"><i class="fa-solid fa-ban"></i>
                Cancel</button>
        </div>
    </div>
</ng-template>